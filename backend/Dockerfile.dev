# Development Dockerfile - uses pre-built binary
# Build the binary locally first: make build-local
FROM alpine:latest

# Install skopeo and set up non-root user
RUN apk add --no-cache skopeo ca-certificates \
	&& addgroup -S imagesync \
	&& adduser -S imagesync -G imagesync

WORKDIR /app

# Copy the pre-built binary from local build
COPY --chown=imagesync:imagesync image-sync-server /app/image-sync-server

# Prepare config directory with restrictive permissions
RUN mkdir -p /configs \
	&& chown 65532:65532 /configs \
	&& chmod 700 /configs

USER 65532:65532

# Expose port
EXPOSE 8080

# Run the application
ENTRYPOINT ["./image-sync-server"]
